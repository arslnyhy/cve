@high(
    name='rule_cve_2024_20320',
    platform=['cisco_iosxr'],
    commands=dict(show_version='show version'),
)
def rule_cve_2024_20320(configuration, commands, device, devices):
    """
    This rule checks for the presence of a vulnerability in Cisco IOS XR Software
    that could allow privilege escalation via the SSH client feature. The vulnerability
    affects specific versions of the software running on certain Cisco routers.
    """

    # Extract the output of the 'show version' command
    show_version_output = commands.show_version

    # Define the vulnerable software versions
    vulnerable_versions = [
        '7.3.2 LNT',
        '7.4 LNT',
        '7.5 LNT',
        '7.6 LNT',
        '7.7 LNT',
        '7.8 LNT',
        '7.9 LNT',
    ]

    # Check if the device's software version is listed as vulnerable
    is_vulnerable = any(version in show_version_output for version in vulnerable_versions)

    # Assert that the device is not running a vulnerable version
    # If the device is running a vulnerable version, the test will fail
    assert not is_vulnerable, (
        f"Device {device.name} is running a vulnerable version of Cisco IOS XR Software. "
        "Please upgrade to a fixed release to mitigate CVE-2024-20320."
    )
